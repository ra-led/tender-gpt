<!DOCTYPE html><html lang="ru"><head>    <meta charset="UTF-8">    <title>Статистика — TenderAI</title>    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <!-- Include Inter/Roboto for consistency -->    <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700|Roboto:400,500,700" rel="stylesheet">    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    <style>        /* OVERRIDES/ENHANCEMENTS for stat page only */        .stat-layout {            display: flex;            gap: 20px;            align-items: flex-start;        }        .stat-fields-panel {            background: #fff;            border-radius: 8px;            padding: 20px 20px 16px 20px;            box-shadow: 0px 4px 16px rgba(0,0,0,0.07);            min-width: 270px;            max-width: 420px;            flex: 1 1 350px;        }        .stat-fields-panel h2 {            font-size: 22px;            margin-top: 0;            margin-bottom: 18px;        }        .stat-field-row {            display: flex;            align-items: baseline;            justify-content: space-between;            margin-bottom: 11px;            padding-bottom: 5px;            border-bottom: 1px solid #f2f3f7;        }        .stat-field-label {            color: #666;            font-size: 14px;            font-weight: 500;            margin-right: 16px;            flex: 0 0 130px;            word-break: break-word;        }        .stat-field-val {            font-size: 16px;            color: #222;            text-align: right;            flex: 1;            min-width: 0;        }        /* Expandable for long text fields */        .expandable-text {            display: inline-block;            max-width: 370px;            max-height: 2.7em;            overflow: hidden;            vertical-align: top;            position: relative;            transition: max-height 0.25s;            cursor: pointer;        }        .expandable-text.expanded {            max-height: 1000px;            white-space: pre-line;        }        .expand-toggle {            display: inline-block;            font-size: 13px;            color: #346AF3;            margin-left: 5px;            cursor: pointer;            text-decoration: underline;            white-space: nowrap;        }        /* Badge for boolean */        .badge-yes, .badge-no {            padding: 2px 10px;            font-size: 13px;            border-radius: 11px;            font-weight: 500;            color: #fff;            margin-left: 1px;            display: inline-block;        }        .badge-yes { background: #00cc88; }        .badge-no { background: #ccc; color: #333; }        /* Stat chart block */        .stat-chart-panel {            background: #fff;            border-radius: 8px;            padding: 20px 24px 18px 24px;            box-shadow: 0px 4px 16px rgba(0,0,0,0.07);            min-width: 340px;            max-width: 600px;            flex: 1 1 440px;        }        .stat-chart-panel h2 {            font-size: 22px;            margin-top: 0;            margin-bottom: 14px;        }        .chart-hint {            color:#666; margin-top:8px; font-size:14px; font-weight: 500;        }        /* Responsive: stack for mobile */        @media (max-width: 920px) {            .stat-layout {                flex-direction: column;                gap: 0;            }            .stat-chart-panel { margin-top: 20px; max-width: none; min-width: 0; padding: 18px 12px; }            .stat-fields-panel { max-width: none; min-width: 0; padding: 16px 8px 10px 8px; }        }        @media (max-width: 560px) {            .stat-fields-panel, .stat-chart-panel { padding: 12px 3vw; }        }    </style></head><body><div class="container">    <!-- Tab bar: identical style/DOM as in tender.html -->    <div class="tab-bar">        <a href="{{ url_for('client_template_stat', client_id=client_id, template_id=template_id) }}" class="active">Статистика</a>        <a href="{{ url_for('dashboard', client_id=client_id) }}?template_id={{ template_id }}">Отчеты</a>    </div>    <div class="stat-layout">        <!-- Left: Profile fields -->        <div class="stat-fields-panel">            <h2>Профиль поиска</h2>            {% set bool_fields = {'fz44': '44-ФЗ', 'fz223': '223-ФЗ'} %}            {% for k, v in template.items() %}                <div class="stat-field-row">                    <div class="stat-field-label">                        {# More friendly label, (replace_code for known fields) #}                        {% if bool_fields.get(k) %}                            {{ bool_fields[k] }}                        {% elif k in ['min_price', 'max_price'] %}                            {{ 'Мин. цена' if k == 'min_price' else 'Макс. цена' }}                        {% elif k == 'keywords' %}Ключевые слова                        {% elif k == 'stopwords' %}Стоп-слова                        {% elif k == 'supplier_description' %}Описание поставки                        {% elif k == 'anti_supplier_description' %}Исключения                        {% else %}                            {{ k|replace('_', ' ')|capitalize }}                        {% endif %}                    </div>                    <div class="stat-field-val">                    {% if k in bool_fields %}                        {% if v %}                          <span class="badge-yes">Да</span>                        {% else %}                          <span class="badge-no">Нет</span>                        {% endif %}                    {% elif k in ['min_price', 'max_price'] %}                        {% if v is not none %}                            {{ '{:,.0f}'.format(v).replace(',', ' ') }} ₽                        {% else %}—{% endif %}                    {% elif k in ['keywords', 'stopwords', 'supplier_description', 'anti_supplier_description'] %}                        {% set maxlen = 55 %}                        <span class="expandable-text" tabindex="0">                            {{ v[:maxlen] }}{% if v|length > maxlen %}...{% endif %}                        </span>                        {% if v|length > maxlen %}                          <span class="expand-toggle">Показать&nbsp;полностью</span>                        {% endif %}                    {% else %}                        {{ v if v else '—' }}                    {% endif %}                    </div>                </div>            {% endfor %}        </div>        <!-- Right: Chart block -->        <div class="stat-chart-panel">            <h2>Динамика по дням</h2>            <canvas id="statChart" width="420" height="205"></canvas>            <div class="chart-hint">                <span style="color:#346AF3;">■</span> Поиск по ключевым словам                 <span style="color:#00CC99; margin-left:17px;">■</span> Подтвердила AI-проверка            </div>        </div>    </div></div><script>    // Chart.js    const data = {{ chart_data|tojson }};    const ctx = document.getElementById('statChart').getContext('2d');    new Chart(ctx, {        type: 'bar',        data: {            labels: data.map(x => x.date.slice(5)), // show mm-dd            datasets: [                {                    label: 'Ключевые слова',                    data: data.map(x => x.kw_count),                    backgroundColor: '#346AF3',                    barThickness: 22,  // side-by-side, thinner for compactness                },                {                    label: 'AI-подтверждено',                    data: data.map(x => x.ai_count),                    backgroundColor: '#00CC99',                    barThickness: 22,                 }            ]        },        options: {            responsive: true,            plugins: {                legend: {                     position: 'top',                    labels: { boxWidth: 10 }                }            },            scales: {                x: { grid: { display: false } },                y: { beginAtZero: true, ticks: { precision: 0 } }            },            interaction: { mode: 'index', intersect: false }        }    });    // JS for expandable text fields    document.querySelectorAll('.expand-toggle').forEach(function(link) {        link.addEventListener('click', function(e) {            const text = this.previousElementSibling;            if (!text.classList.contains('expanded')) {                text.classList.add('expanded');                this.textContent = 'Скрыть';            } else {                text.classList.remove('expanded');                this.textContent = 'Показать полностью';            }        });    });    document.querySelectorAll('.expandable-text').forEach(function(span) {        span.addEventListener('keydown', function(e) {            if (e.key === "Enter" || e.key === " ") {                const toggle = this.nextElementSibling;                if (toggle && toggle.classList.contains('expand-toggle')) toggle.click();            }        })    });</script></body></html>