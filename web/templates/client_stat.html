<!DOCTYPE html><html lang="ru"><head>  <meta charset="UTF-8">  <title>Статистика — TenderAI</title>  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- Fonts & base CSS -->  <link href="https://fonts.googleapis.com/css?family=Inter:400,500,700|Roboto:400,500,700" rel="stylesheet">  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">  <!-- Chart.js -->  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>  <style>    /* Layout for stats page */    .stat-layout { display: flex; gap: 20px; align-items: flex-start; }    .stat-fields-panel,    .stat-chart-panel {      background: #fff;      border-radius: 8px;      box-shadow: 0 4px 16px rgba(0,0,0,0.07);      padding: 20px;    }    .stat-fields-panel { flex: 1 1 320px; max-width: 420px; }    .stat-chart-panel  { flex: 1 1 420px; max-width: 600px; }    .stat-fields-panel h2,    .stat-chart-panel h2 {      margin-top: 0;      margin-bottom: 16px;      font-size: 20px;      font-weight: 500;    }    .stat-field-row {      display: flex;      justify-content: space-between;      padding: 8px 0;      border-bottom: 1px solid #F2F3F7;      font-size: 15px;    }    .stat-field-label { color: #666; flex: 0 0 130px; }    .stat-field-val   { text-align: right; flex: 1; min-width: 0; color: #222; }    /* Booleans as badges */    .badge-yes, .badge-no {      display: inline-block;      padding: 2px 8px;      border-radius: 12px;      font-size: 13px;      font-weight: 500;      color: #fff;    }    .badge-yes { background: #00CC88; }    .badge-no  { background: #CCC; color: #333; }    /* Expandable text */    .expandable-text {      display: block;      max-height: 2.4em;      overflow: hidden;      transition: max-height 0.25s;      cursor: pointer;    }    .expandable-text.expanded { max-height: 1000px; }    .expand-toggle {      font-size: 13px;      color: #346AF3;      text-decoration: underline;      cursor: pointer;      margin-top: 2px;      display: inline-block;    }    /* Chart hint */    .chart-hint {      margin-top: 8px;      font-size: 14px;      color: #666;    }    /* Responsive */    @media (max-width: 900px) {      .stat-layout { flex-direction: column; }      .stat-chart-panel { margin-top: 20px; }    }  </style></head><body>  {% include '_tab_bar.html' %}  <div class="container">    <div class="stat-layout">      <!-- Profile fields -->      <div class="stat-fields-panel">        <h2>Профиль поиска</h2>        {% set bool_fields = {'fz44': '44-ФЗ', 'fz223': '223-ФЗ'} %}        {% for k, v in template.items() %}          <div class="stat-field-row">            <div class="stat-field-label">              {% if bool_fields.get(k)      %} {{ bool_fields[k] }}              {% elif k == 'min_price'     %} Мин. цена              {% elif k == 'max_price'     %} Макс. цена              {% elif k == 'keywords'      %} Ключевые слова              {% elif k == 'stopwords'     %} Стоп-слова              {% elif k == 'supplier_description'      %} Описание поставки              {% elif k == 'anti_supplier_description' %} Исключения              {% else %} {{ k|replace('_',' ')|capitalize }} {% endif %}            </div>            <div class="stat-field-val">              {% if bool_fields.get(k) %}                <span class="badge-yes" {% if not v %}class="badge-no"{% endif %}>                  {{ v and 'Да' or 'Нет' }}                </span>              {% elif k in ['min_price','max_price'] %}                {% if v is not none %}                  {{ '{:,.0f}'.format(v).replace(',', ' ') }} ₽                {% else %} — {% endif %}              {% elif k in ['keywords','stopwords','supplier_description','anti_supplier_description'] %}                <div>                  <div class="expandable-text">{{ v }}</div>                  <div class="expand-toggle">Показать полностью</div>                </div>              {% else %}                {{ v or '—' }}              {% endif %}            </div>          </div>        {% endfor %}      </div>      <!-- Chart -->      <div class="stat-chart-panel">        <h2>Динамика по дням</h2>        <canvas id="statChart" width="420" height="200"></canvas>        <div class="chart-hint">          <span style="color:#346AF3;">■</span> Поиск по ключевым словам          <span style="margin-left:16px;color:#00CC99;">■</span> AI-подтверждено        </div>      </div>    </div>  </div>  <script>    // Chart.js init (same as before, with thinner bars)    const data = {{ chart_data|tojson }};    const ctx = document.getElementById('statChart').getContext('2d');    new Chart(ctx, {      type: 'bar',      data: {        labels: data.map(x => x.date.slice(5)),         datasets: [          {            label: 'Ключевые слова',            data: data.map(x => x.kw_count),            backgroundColor: '#346AF3',            barThickness: 18,          },          {            label: 'AI-подтверждено',            data: data.map(x => x.ai_count),            backgroundColor: '#00CC99',            barThickness: 18,          }        ]      },      options: {        responsive: true,        plugins: {          legend: { position: 'top', labels:{ boxWidth: 10 } }        },        scales: {          x: { grid:{ display:false } },          y: { beginAtZero:true, ticks:{ precision:0 } }        },        interaction:{ mode:'index', intersect:false }      }    });    // Expand/collapse long text    document.querySelectorAll('.expand-toggle').forEach(el=>{      el.onclick = ()=>{        const txt = el.previousElementSibling;        txt.classList.toggle('expanded');        el.textContent = txt.classList.contains('expanded')                        ? 'Скрыть'                        : 'Показать полностью';      };    });  </script></body></html>